.mixer          ; section mixer
; [o_M]
loop:
;load0 dup 2 yield :loop jmp
load0 2 3 dupn ocall 2 yield :loop jmp

.note
                ; o_M f_vel i_note i_inst
pop             ; o_M f_vel i_note
3 ndup
load0 load0     ; o_M f_vel i_note i_track=0 i_index=0
3 6 get         ; o_M f_vel i_note i_track=0 i_index=0 3 6
; SPAWN instr: [f_vel i_note i_track i_index 3 o_M]
ocall
pop swap 1 swap 13 swap 4 swap ocall
load0 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.ctl
; i_ctl, f_val, o_M]
;dump
dup 769 icmpeq :c01 jnz
dup 770 icmpeq :c02 jnz
dup 771 icmpeq :c03 jnz
dup 772 icmpeq :c04 jnz
dup 773 icmpeq :c05 jnz
dup 774 icmpeq :c06 jnz
dup 775 icmpeq :c07 jnz
dup 776 icmpeq :c08 jnz
dup 777 icmpeq :c09 jnz

exit: pop pop pop
load0 ret

c01: pop
; f_val o_M]
2 ndup

swap 1 swap 1 swap ; M 1 1 v v M]
ocall

;v M]
swap 1 swap 1 swap 4 swap ; M 4 1 1 v]
ocall

load0 ret

c02: pop
; f_val o_M]
2 ndup

swap 2 swap 1 swap ; M 1 1 v v M]
ocall

;v M]
swap 1 swap 2 swap 4 swap ; M 4 1 1 v]
ocall

load0 ret

c03: pop 2 ndup
swap 3 swap 1 swap ocall
swap 1 swap 3 swap 4 swap ocall
load0 ret

c04: pop 2 ndup
swap 4 swap 1 swap ocall
swap 1 swap 4 swap 4 swap ocall
load0 ret

c05: pop 2 ndup
swap 5 swap 1 swap ocall
swap 1 swap 5 swap 4 swap ocall
load0 ret

c06: pop 2 ndup
swap 6 swap 1 swap ocall
swap 1 swap 6 swap 4 swap ocall
load0 ret

c07: pop 2 ndup
swap 7 swap 1 swap ocall
swap 1 swap 7 swap 4 swap ocall
load0 ret

c08: pop 2 ndup
swap 8 swap 1 swap ocall
swap 1 swap 8 swap 4 swap ocall
load0 ret

c09: pop 2 ndup
swap 9 swap 1 swap ocall
swap 1 swap 9 swap 4 swap ocall
load0 ret


; SET_GLOBAL: o_M i_1 i_# v_v]


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.instr0
; [o_M f_vel i_note f_dphase]
;dump
load0           ; [] 0

loop:           ;
2 dupn fadd     ; [o_M f_vel i_note f_dphase phase+f_dphase
fphase          ; [o_M f_vel i_note f_dphase phase

;4 get 1.0 fmul dup ; [o_M i_note f_dphase phase V V
;dump
;4 put
;dump
;0.01 swap fcmpgt :end jnz
;2 dupn fph2rad fsin fmul dup

dup fph2rad fsin
; f_sin, f_phase, f_dphase, i_note, f_vel, o_M]
;dump
5 get
;dump
; f_vel, f_sin, f_phase, f_dphase, i_note, o_M]

0.99994 fmul dup
5 put

; f_vel, f_sin, f_phase, f_dphase, i_note, f_vel, o_M]

dup
0.01
fcmpgt
:end jnz

fmul 0.5 fmul

;output
dup 2 yield
:loop jmp

end:
;dump
pop pop pop pop pop pop pop
load0 dup 2 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.instr1
; [o_M f_vel i_note f_dphase]
;dump
load0           ; [] 0

loop:           ;
2 dupn fadd     ; [o_M f_vel i_note f_dphase phase+f_dphase
fphase          ; [o_M f_vel i_note f_dphase phase

;4 get 1.0 fmul dup ; [o_M i_note f_dphase phase V V
;dump
;4 put
;dump
;0.01 swap fcmpgt :end jnz
;2 dupn fph2rad fsin fmul dup

dup fph2rad
;fsin
0.02 fmul
; f_sin, f_phase, f_dphase, i_note, f_vel, o_M]
;dump
5 get
;dump
; f_vel, f_sin, f_phase, f_dphase, i_note, o_M]

0.9998 fmul dup
5 put

; f_vel, f_sin, f_phase, f_dphase, i_note, f_vel, o_M]

dup
0.01
fcmpgt
:end jnz

fmul

;output
dup 2 yield
:loop jmp

end:
;dump
pop pop pop pop pop pop pop
load0 dup 2 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.instr2
; [o_M f_vel i_note f_dphase]
load0           ; phase = 0

loop:           ;
2 dupn fadd     ; [o_M f_vel i_note f_dphase phase+f_dphase
fphase          ; [o_M f_vel i_note f_dphase phase
dup fph2rad fsin dup

;5 dupn dup
5 get
;dump
; f_vel, f_sin, f_phase, f_dphase, i_note, o_M]

0.9994 fmul dup
5 put

0.01
fcmpgt
:end jnz

; env
fmul

;output
dup 2 yield
:loop jmp

end:
;dump
pop pop pop pop pop pop pop
load0 dup 2 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.seq2 ; o_M]
loop:
; SPAWN instr: f_vel i_note i_track i_index 3 o_M]
0.7 55 load0 load0 3 6 dupn ocall
dup 1.0 swap 1 swap 14 swap 4 swap ocall
60 load0 yield 7 loopdecnz
0.7 57 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 2.0 swap 1 swap 14 swap 4 swap ocall
0.7 67 load0 load0 3 6 dupn ocall 2 load0 yield 7 loopdecnz
dup 4.0 swap 1 swap 14 swap 4 swap ocall
0.7 69 load0 load0 3 6 dupn ocall 2 load0 yield 7 loopdecnz
dup 5.0 swap 1 swap 14 swap 4 swap ocall
0.7 67 load0 load0 3 6 dupn ocall 8 load0 yield 7 loopdecnz
dup 4.0 swap 1 swap 14 swap 4 swap ocall
0.7 64 load0 load0 3 6 dupn ocall 52 load0 yield 7 loopdecnz
dup 3.0 swap 1 swap 14 swap 4 swap ocall
:loop jmp

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
.seq1
; [o_M]
loop:
1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
0.9 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

0.9 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz


:loop jmp


.seq0
; [o_M]
;pop load0 ret
loop:
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 1.0 swap 1 swap 15 swap 4 swap ocall
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 2.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 3.0 swap 1 swap 15 swap 4 swap ocall
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 4.0 swap 1 swap 15 swap 4 swap ocall

1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 1.0 swap 1 swap 15 swap 4 swap ocall
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 2.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 3.0 swap 1 swap 15 swap 4 swap ocall
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 4.0 swap 1 swap 15 swap 4 swap ocall

1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 1.0 swap 1 swap 15 swap 4 swap ocall
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 2.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 3.0 swap 1 swap 15 swap 4 swap ocall
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 4.0 swap 1 swap 15 swap 4 swap ocall

1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 1.0 swap 1 swap 15 swap 4 swap ocall
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 2.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 3.0 swap 1 swap 15 swap 4 swap ocall
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 4.0 swap 1 swap 15 swap 4 swap ocall

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 5.0 swap 1 swap 15 swap 4 swap ocall
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 6.0 swap 1 swap 15 swap 4 swap ocall
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 7.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 8.0 swap 1 swap 15 swap 4 swap ocall

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 5.0 swap 1 swap 15 swap 4 swap ocall
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 6.0 swap 1 swap 15 swap 4 swap ocall
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 7.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 8.0 swap 1 swap 15 swap 4 swap ocall

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 5.0 swap 1 swap 15 swap 4 swap ocall
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 6.0 swap 1 swap 15 swap 4 swap ocall
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 7.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 8.0 swap 1 swap 15 swap 4 swap ocall

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 5.0 swap 1 swap 15 swap 4 swap ocall
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 6.0 swap 1 swap 15 swap 4 swap ocall
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 7.0 swap 1 swap 15 swap 4 swap ocall
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
dup 8.0 swap 1 swap 15 swap 4 swap ocall

; SPAWN instr: [f_vel i_note i_track i_index 3 o_M]
:loop jmp
