.mixer          ; section mixer
; [o_M]
loop:
;load0 dup 2 yield :loop jmp
load0 2 3 dupn ocall 2 yield :loop jmp

.note
                ; o_M f_vel i_note i_inst
pop             ; o_M f_vel i_note
load0 load0     ; o_M f_vel i_note i_track=0 i_index=0
3 6 get         ; o_M f_vel i_note i_track=0 i_index=0 3 6
; SPAWN instr: [f_vel i_note i_track i_index 3 o_M]
dump ocall
load0 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.ctl

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.instr0
; [o_M f_vel i_note f_dphase]
;dump
load0           ; [] 0

loop:           ;
2 dupn fadd     ; [o_M f_vel i_note f_dphase phase+f_dphase
fphase          ; [o_M f_vel i_note f_dphase phase

;4 get 1.0 fmul dup ; [o_M i_note f_dphase phase V V
;dump
;4 put
;dump
;0.01 swap fcmpgt :end jnz
;2 dupn fph2rad fsin fmul dup

dup fph2rad fsin
; f_sin, f_phase, f_dphase, i_note, f_vel, o_M]
;dump
5 get
;dump
; f_vel, f_sin, f_phase, f_dphase, i_note, o_M]

0.99994 fmul dup
5 put

; f_vel, f_sin, f_phase, f_dphase, i_note, f_vel, o_M]

dup
0.01
fcmpgt
:end jnz

fmul 0.5 fmul

;output
dup 2 yield
:loop jmp

end:
;dump
pop pop pop pop pop pop pop
load0 dup 2 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.instr1
; [o_M f_vel i_note f_dphase]
;dump
load0           ; [] 0

loop:           ;
2 dupn fadd     ; [o_M f_vel i_note f_dphase phase+f_dphase
fphase          ; [o_M f_vel i_note f_dphase phase

;4 get 1.0 fmul dup ; [o_M i_note f_dphase phase V V
;dump
;4 put
;dump
;0.01 swap fcmpgt :end jnz
;2 dupn fph2rad fsin fmul dup

dup fph2rad
;fsin
0.02 fmul
; f_sin, f_phase, f_dphase, i_note, f_vel, o_M]
;dump
5 get
;dump
; f_vel, f_sin, f_phase, f_dphase, i_note, o_M]

0.9998 fmul dup
5 put

; f_vel, f_sin, f_phase, f_dphase, i_note, f_vel, o_M]

dup
0.01
fcmpgt
:end jnz

fmul

;output
dup 2 yield
:loop jmp

end:
;dump
pop pop pop pop pop pop pop
load0 dup 2 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.instr2
; [o_M f_vel i_note f_dphase]
load0           ; phase = 0

loop:           ;
2 dupn fadd     ; [o_M f_vel i_note f_dphase phase+f_dphase
fphase          ; [o_M f_vel i_note f_dphase phase
dup fph2rad fsin dup

;5 dupn dup
5 get
;dump
; f_vel, f_sin, f_phase, f_dphase, i_note, o_M]

0.9994 fmul dup
5 put

0.01
fcmpgt
:end jnz

; env
fmul

;output
dup 2 yield
:loop jmp

end:
;dump
pop pop pop pop pop pop pop
load0 dup 2 ret

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

.seq2 ; o_M]
loop:
; SPAWN instr: f_vel i_note i_track i_index 3 o_M]
0.7 55 load0 load0 3 6 dupn ocall
60 load0 yield 7 loopdecnz
0.7 57 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
0.7 67 load0 load0 3 6 dupn ocall 2 load0 yield 7 loopdecnz
0.7 69 load0 load0 3 6 dupn ocall 2 load0 yield 7 loopdecnz
0.7 67 load0 load0 3 6 dupn ocall 8 load0 yield 7 loopdecnz
0.7 64 load0 load0 3 6 dupn ocall 52 load0 yield 7 loopdecnz
:loop jmp

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
.seq1
; [o_M]
loop:
1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 43 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 50 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 48 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz
0.9 45 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz

0.9 52 load0 1 3 6 dupn ocall 4 load0 yield 7 loopdecnz


:loop jmp


.seq0
; [o_M]
;pop load0 ret
loop:
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 33 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 40 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

1.0 29 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 31 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 36 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz
1.0 38 load0 load0 3 6 dupn ocall 4 load0 yield 7 loopdecnz

; SPAWN instr: [f_vel i_note i_track i_index 3 o_M]
:loop jmp
